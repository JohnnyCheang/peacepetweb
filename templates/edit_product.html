{% extends "layout.html" %}
{% block content %}
<style>
/* Edit Product 页面美化 CSS - 修复 #1 UI 错乱 */
.edit-container {
    max-width: 900px; 
    margin: 40px auto 80px; 
    background: white; 
    padding: 30px; 
    border-radius: 10px; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
.input-group-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}
.input-group-row > div {
    flex: 1;
}
.input-group-row label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    font-size: 0.9rem;
}
.input-group-row input[type="text"], 
.input-group-row input[type="number"], 
.input-group-row textarea, 
.input-group-row select,
.edit-container input[type="file"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
    font-size: 0.9rem;
}
.image-preview {
    max-height: 80px; 
    margin-bottom: 10px; 
    border: 1px solid #ddd;
    border-radius: 5px;
    object-fit: cover;
}
fieldset {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
}
legend {
    font-weight: bold;
    color: var(--primary, #375E97);
    padding: 0 10px;
}
</style>

<div class="edit-container">
    <h2 class="serif" style="text-align: center; color: var(--primary, #375E97); margin-bottom: 25px;">编辑产品: {{ product['title_zh'] }}</h2>
    <a href="{{ url_for('admin') }}" style="display: inline-block; margin-bottom: 20px; color: var(--accent, #FB6542); text-decoration: none; font-weight: 600;">&larr; 返回管理面板</a>

    <form method="POST" enctype="multipart/form-data" action="{{ url_for('edit_product', product_id=product['id']) }}">
        
        <fieldset>
            <legend>基本信息</legend>
            <div class="input-group-row">
                <div><label>产品标题 (EN)</label><input type="text" name="title_en" value="{{ product['title_en'] }}" required></div>
                <div><label>产品标题 (ZH)</label><input type="text" name="title_zh" value="{{ product['title_zh'] }}" required></div>
            </div>
            <div class="input-group-row">
                <div><label>价格 (USD)</label><input type="text" name="price" value="{{ product['price'] }}" required></div>
                <div>
                    <label>分类</label>
                    <select name="category_id" required>
                        {% for cat in categories_list %}
                            <option value="{{ cat['id'] }}" {% if cat['id'] == product['category_id'] %}selected{% endif %}>{{ cat['name_zh'] }} ({{ cat['name_en'] }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="input-group-row">
                <div><label>月销量</label><input type="number" name="monthly_sales" value="{{ product['monthly_sales'] }}"></div>
                <div><label>星级 (1.0 - 5.0)</label><input type="number" step="0.1" max="5" min="1" name="avg_rating" value="{{ product['avg_rating'] }}"></div>
            </div>
        </fieldset>
        
        <fieldset>
            <legend>产品标签 & 展示设置</legend>
            <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="is_deal" {% if product['is_deal'] == 1 %}checked{% endif %} style="width: 16px; height: 16px; margin-right: 8px;"> 促销 (DEAL)
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" name="is_new" {% if product['is_new'] == 1 %}checked{% endif %} style="width: 16px; height: 16px; margin-right: 8px;"> 新品 (NEW)
                </label>
                <label style="display: flex; align-items: center; cursor: pointer; color: var(--primary, #375E97); font-weight: bold;">
                    <input type="checkbox" name="is_featured" {% if product['is_featured'] == 1 %}checked{% endif %} style="width: 16px; height: 16px; margin-right: 8px;"> 首页推荐 (FEATURED)
                </label>
            </div>
        </fieldset>

        <fieldset>
            <legend>图片管理</legend>
            <h5 style="margin-top: 5px;">主图</h5>
            {% if product['main_image'] %}
                <p style="font-size: 0.9rem; color: #555;">当前主图:</p>
                <img src="{{ product['main_image'] }}" class="image-preview">
            {% endif %}
            <label>替换主图</label><input type="file" name="main_image">

            <h5 style="margin-top: 20px;">A+ 详情图片</h5>
            {% if a_plus_imgs and a_plus_imgs[0] %}
            <p style="color: red; font-weight: 600; font-size: 0.9rem;">注意: 上传新图片将**替换**所有现有 A+ 图片。</p>
            <p style="font-size: 0.9rem; color: #555;">现有 A+ 图片 (共 {{ a_plus_imgs | length }} 张):</p>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                {% for img in a_plus_imgs %}
                    <img src="{{ img }}" style="height: 60px; object-fit: cover; border: 1px solid #ddd; border-radius: 3px;">
                {% endfor %}
            </div>
            {% endif %}
            
            <label style="color: var(--primary, #375E97); font-weight:bold;">上传 A+ 详情图片 (可多选，将替换现有)</label>
            <input type="file" name="a_plus_images" multiple>
        </fieldset>

        <fieldset>
            <legend>详细描述</legend>
            <div class="input-group-row">
                <div><label>五点描述 (EN)</label><textarea name="bullet_points_en" rows="5">{{ product['bullet_points_en'] }}</textarea></div>
                <div><label>五点描述 (ZH)</label><textarea name="bullet_points_zh" rows="5">{{ product['bullet_points_zh'] }}</textarea></div>
            </div>
            <div class="input-group-row">
                <div><label>详细描述 (A+ Text EN)</label><textarea name="description_en" rows="3">{{ product['description_en'] }}</textarea></div>
                <div><label>详细描述 (A+ Text ZH)</label><textarea name="description_zh" rows="3">{{ product['description_zh'] }}</textarea></div>
            </div>
        </fieldset>
        
        <button type="submit" class="btn" style="width: 100%; margin-top: 20px; background: var(--accent, #FB6542);">保存产品修改</button>
    </form>
</div>
{% endblock %}